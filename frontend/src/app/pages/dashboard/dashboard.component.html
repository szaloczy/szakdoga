<div class="container mt-4">
  <h2>{{ 'dashboard.title' | translate }} {{user?.firstname}} {{user?.lastname}}!</h2>

  @if (authService.getRole() === "student") {
    <div class="row g-4 my-4">
      @for (card of summaryCards; track card) {
      <div class="col-12 col-md-6 col-lg-3">
        <div class="card shadow-lg border-0 h-100 animate__animated animate__fadeInUp" [ngClass]="card.bg">
          <div class="card-body d-flex flex-column justify-content-center align-items-center">
            <i class="bi bi-star-fill fs-1 mb-2 text-warning"></i>
            <h5 class="card-title text-white">{{ card.title | translate }}</h5>
            <p class="card-text display-6 fw-bold text-white mb-0">{{ card.value }}</p>
          </div>
        </div>
      </div>
      }
    </div>

    <div class="d-flex gap-3 mt-3 flex-wrap justify-content-center">
      <button class="btn btn-gradient-primary px-4 py-2 rounded-pill shadow"><i class="bi bi-upload me-2"></i>{{ 'dashboard.student.upload_documents' | translate }}</button>
      <button class="btn btn-gradient-secondary px-4 py-2 rounded-pill shadow"><i class="bi bi-plus-circle me-2"></i>{{ 'dashboard.student.add_internship' | translate }}</button>
      <button class="btn btn-gradient-info px-4 py-2 rounded-pill shadow"><i class="bi bi-clock-history me-2"></i>{{ 'dashboard.student.previous_internships' | translate }}</button>
    </div>

    <div class="row g-4 mt-4 justify-content-center">
      <div class="col-12 col-lg-4">
        <div class="card border-0 shadow-lg animate__animated animate__fadeInLeft">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="bi bi-person me-2"></i>{{ 'dashboard.student.personal_data' | translate }}</h5>
          </div>
          <div class="card-body">
            <ul class="list-group list-group-flush">
              <li class="list-group-item"><strong>{{ 'dashboard.student.name' | translate }}:</strong> {{ studentProfile?.user?.firstname }} {{ studentProfile?.user?.lastname }}</li>
              <li class="list-group-item"><strong>{{ 'dashboard.student.neptun' | translate }}:</strong> {{ studentProfile?.neptun }}</li>
              <li class="list-group-item"><strong>{{ 'dashboard.student.university' | translate }}:</strong> {{ studentProfile?.university }}</li>
              <li class="list-group-item"><strong>{{ 'dashboard.student.major' | translate }}:</strong> {{ studentProfile?.major }}</li>
            </ul>
          </div>
        </div>
      </div>
      
      @if (dashboardProgress) {
      <div class="col-12 col-lg-4">
        <div class="card border-0 shadow-lg animate__animated animate__fadeInUp">
          <div class="card-header bg-warning text-white">
            <h5 class="mb-0"><i class="bi bi-graph-up-arrow me-2"></i>{{ 'dashboard.student.progress_status' | translate }}</h5>
          </div>
          <div class="card-body d-flex justify-content-center align-items-center py-4">
            <div class="position-relative d-inline-block">
              <svg width="180" height="180" class="circular-progress">
                <circle cx="90" cy="90" r="75" fill="none" stroke="#e9ecef" stroke-width="12"/>
                <circle cx="90" cy="90" r="75" fill="none" stroke="#28a745" stroke-width="12" 
                        stroke-linecap="round" 
                        [style.stroke-dasharray]="2 * 3.14159 * 75"
                        [style.stroke-dashoffset]="2 * 3.14159 * 75 - (dashboardProgress.percentage / 100) * 2 * 3.14159 * 75"
                        style="transform: rotate(-90deg); transform-origin: center;"/>
              </svg>
              <div class="position-absolute top-50 start-50 translate-middle text-center">
                <div class="fw-bold text-success" style="font-size: 1.5rem;">{{ dashboardProgress.completed }}</div>
                <div class="text-muted" style="font-size: 1.2rem;">/{{ dashboardProgress.total }}</div>
              </div>
            </div>
          </div>
          <div class="card-footer bg-light text-center">
            <small class="text-muted">{{ 'dashboard.student.completed_vs_required_hours' | translate }}</small>
          </div>
        </div>
      </div>
      }
      
      @if (internshipInfo) {
      <div class="col-12 col-lg-4">
        <div class="card border-0 shadow-lg animate__animated animate__fadeInRight">
          <div class="card-header bg-info text-white">
            <h5 class="mb-0"><i class="bi bi-briefcase me-2"></i>{{ 'dashboard.student.internship_info' | translate }}</h5>
          </div>
          <div class="card-body">
            <ul class="list-group list-group-flush">
              <li class="list-group-item"><strong>{{ 'dashboard.student.company' | translate }}:</strong> {{ internshipInfo.company?.name }}</li>
              <li class="list-group-item"><strong>{{ 'dashboard.student.mentor' | translate }}:</strong> {{ internshipInfo.mentor?.firstname }} {{ internshipInfo.mentor?.lastname }}</li>
              <li class="list-group-item"><strong>{{ 'dashboard.student.period' | translate }}:</strong> {{ internshipInfo.startDate | date:'yyyy.MM.dd' }} - {{ internshipInfo.endDate | date:'yyyy.MM.dd' }}</li>
              <li class="list-group-item"><strong>{{ 'dashboard.student.status' | translate }}:</strong> <span [ngClass]="internshipInfo.isApproved ? 'text-success' : 'text-warning'">{{ internshipInfo.isApproved ? ('dashboard.student.approved' | translate) : ('dashboard.student.pending' | translate) }}</span></li>
            </ul>
          </div>
        </div>
      </div>
      }
    </div>

    <div class="card mt-4 border-0 shadow-lg animate__animated animate__fadeInUp">
      <div class="card-header bg-success text-white">
        <h5 class="mb-0"><i class="bi bi-clock-history me-2"></i>{{ 'dashboard.student.hours_summary' | translate }}</h5>
      </div>
      <div class="card-body">
        <div class="mb-3">
          <label class="form-label">{{ 'dashboard.student.approved_hours' | translate }}</label>
          <div class="progress">
            <div class="progress-bar bg-success" role="progressbar" [style.width]="(studentHourStats.approved / (studentHours.length || 1)) * 100 + '%'" aria-valuenow="studentHourStats.approved" aria-valuemin="0" aria-valuemax="studentHours.length">{{ studentHourStats.approved }}</div>
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">{{ 'dashboard.student.pending_hours' | translate }}</label>
          <div class="progress">
            <div class="progress-bar bg-warning" role="progressbar" [style.width]="(studentHourStats.pending / (studentHours.length || 1)) * 100 + '%'" aria-valuenow="studentHourStats.pending" aria-valuemin="0" aria-valuemax="studentHours.length">{{ studentHourStats.pending }}</div>
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label">{{ 'dashboard.student.rejected_hours' | translate }}</label>
          <div class="progress">
            <div class="progress-bar bg-danger" role="progressbar" [style.width]="(studentHourStats.rejected / (studentHours.length || 1)) * 100 + '%'" aria-valuenow="studentHourStats.rejected" aria-valuemin="0" aria-valuemax="studentHours.length">{{ studentHourStats.rejected }}</div>
          </div>
        </div>
        <p class="mt-3"><strong>{{ 'dashboard.student.total_hours' | translate }}:</strong> {{ studentHours.length }}</p>
      </div>
    </div>

    @if (studentDocuments.length > 0) {
    <div class="card mt-4 border-0 shadow-lg animate__animated animate__fadeInUp">
      <div class="card-header bg-secondary text-white">
        <h5 class="mb-0"><i class="bi bi-file-earmark-text me-2"></i>{{ 'dashboard.student.uploaded_documents' | translate }}</h5>
      </div>
      <div class="card-body">
        <ul class="list-group">
          @for (doc of studentDocuments; track doc) {
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <strong>{{ doc.originalName }}</strong> <span class="badge bg-light text-dark ms-2">
                @switch (doc.status) {
                  @case ('pending') {
                    <span class="badge bg-warning text-dark"><i class="bi bi-hourglass-split me-1"></i>{{ 'dashboard.student.status.pending' | translate }}</span>
                  }
                  @case ('approved') {
                    <span class="badge bg-success"><i class="bi bi-check-circle-fill me-1"></i>{{ 'dashboard.student.status.approved' | translate }}</span>
                  }
                  @case ('rejected') {
                    <span class="badge bg-danger"><i class="bi bi-x-circle-fill me-1"></i>{{ 'dashboard.student.status.rejected' | translate }}</span>
                  }
                  @default {
                    <span class="badge bg-secondary"><i class="bi bi-question-circle me-1"></i>{{ doc.status }}</span>
                  }
                }

              </span>
              @if (doc.reviewNote) {
              <span class="ms-2 text-muted"> ({{ 'dashboard.student.note' | translate }}: {{ doc.reviewNote }})</span>
              }
            </div>
            <span class="text-muted">{{ doc.uploadedAt | date:'yyyy.MM.dd HH:mm' }}</span>
          </li>
          }
        </ul>
      </div>
    </div>
    }

  } @else if (authService.getRole() === "mentor") {
    <!-- Mentor Dashboard -->
    @if (isLoadingMentorData) {
      <div class="d-flex justify-content-center my-5">
        <div class="spinner-border" role="status">
          <span class="visually-hidden">{{ 'dashboard.loading' | translate }}</span>
        </div>
      </div>
    } @else {
      <!-- Mentor Statistics Cards -->
      <div class="row my-4">
        @for(card of mentorCards; track card) {
        <div class="col-md-3">
          <div class="card text-white mb-3" [ngClass]="card.bg">
            <div class="card-body d-flex align-items-center">
              <div class="flex-grow-1">
                <h5 class="card-title">{{ card.title | translate }}</h5>
                <p class="card-text fs-4 fw-bold mb-0">{{ card.value }}</p>
              </div>
              <i class="{{card.icon}} fs-1 opacity-75"></i>
            </div>
          </div>
        </div>
        }
      </div>

      <!-- Mentor Company Info -->
      @if (mentorProfile) {
        <div class="card mb-4">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="bi bi-building me-2"></i>{{ 'dashboard.mentor.company_info' | translate }}</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <p><strong>{{ 'dashboard.mentor.company_name' | translate }}:</strong> {{ mentorProfile.mentor.company.name }}</p>
                <p><strong>{{ 'dashboard.mentor.position' | translate }}:</strong> {{ mentorProfile.mentor.position }}</p>
              </div>
              <div class="col-md-6">
                <p><strong>{{ 'dashboard.mentor.city' | translate }}:</strong> {{ mentorProfile.mentor.company.city }}</p>
                <p><strong>{{ 'dashboard.mentor.email' | translate }}:</strong> {{ mentorProfile.mentor.company.email }}</p>
              </div>
            </div>
          </div>
        </div>
      }

      <!-- Quick Actions -->
      <div class="card mb-4">
        <div class="card-header bg-secondary text-white">
          <h5 class="mb-0"><i class="bi bi-lightning-fill me-2"></i>{{ 'dashboard.mentor.quick_actions' | translate }}</h5>
        </div>
        <div class="card-body">
          <div class="row">
            
            <div class="col-md-6 col-lg-3 mb-3">
              <button 
                class="btn btn-outline-primary w-100 h-100 position-relative" >
                <i class="fs-4 d-block mb-2"></i>
                <span class="d-block">{{ 'dashboard.mentor.approve_hour' | translate }}</span>
                <i class="bi bi-hourglass me-2"></i>
              </button>
            </div>

            <div class="col-md-6 col-lg-3 mb-3">
              <button 
                class="btn btn-outline-primary w-100 h-100 position-relative" >
                <i class="fs-4 d-block mb-2"></i>
                <span class="d-block">{{ 'dashboard.mentor.upload_documents' | translate }}</span>
                <i class="bi bi-upload me-2"></i>
              </button>
            </div>
            
            <div class="col-md-6 col-lg-3 mb-3">
              <button 
                class="btn btn-outline-primary w-100 h-100 position-relative" >
                <i class="fs-4 d-block mb-2"></i>
                <span class="d-block">{{ 'dashboard.mentor.view_all_students' | translate }}</span>
                <i class="bi bi-eye me-2"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Students Activity -->
      <div class="card">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0"><i class="bi bi-people-fill me-2"></i>{{ 'dashboard.mentor.recent_students_activity' | translate }}</h5>
        </div>
        <div class="card-body">
          @if (mentorStudents.length > 0) {
            <div class="list-group list-group-flush">
              @for(student of mentorStudents.slice(0, 5); track student) {
              <div class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="mb-1">{{ student.firstname }} {{ student.lastname }}</h6>
                  <p class="mb-1 text-muted">{{ student.university || ('dashboard.mentor.university_not_provided' | translate) }}</p>
                  <small>{{ 'dashboard.mentor.hours_count' | translate }}: {{ mentorStudentHourStats[student.id] ? mentorStudentHourStats[student.id].total : 0 }}</small>
                </div>
                <div class="text-end">
                  @if (mentorStudentHourStats[student.id] && mentorStudentHourStats[student.id].pending > 0) {
                    <span class="badge bg-warning">{{ 'dashboard.mentor.pending_approval' | translate }}</span>
                  } @else {
                    <span class="badge bg-success">{{ 'dashboard.mentor.up_to_date' | translate }}</span>
                  }
                </div>
              </div>
              }
            </div>
            
            @if (mentorStudents.length > 5) {
              <div class="text-center mt-3">
                <button class="btn btn-outline-primary">{{ 'dashboard.mentor.view_all_students' | translate }} ({{ mentorStudents.length }})</button>
              </div>
            }
          } @else {
            <div class="text-center text-muted py-4">
              <i class="bi bi-people fs-1 d-block mb-3"></i>
              <p>{{ 'dashboard.mentor.no_students_assigned' | translate }}</p>
            </div>
          }
        </div>
      </div>
    }

  } @else {
    <!-- Admin Dashboard -->
    <app-student-list></app-student-list>
  }
</div>


